/* Copyright: Ankitects Pty Ltd and contributors
 * License: GNU AGPL, version 3 or later; http://www.gnu.org/licenses/agpl.html */
@use "vars";
@use "sass:color";
@use "./elevation" as *;

@import "bootstrap/scss/functions";
@import "bootstrap/scss/variables";

@mixin impressed-shadow($intensity) {
    box-shadow: inset 0 calc(var(--buttons-size, 10px) / 15)
        calc(var(--buttons-size, 10px) / 5) rgba(black, $intensity);
}

@mixin border-radius {
    border-top-left-radius: var(--border-left-radius);
    border-bottom-left-radius: var(--border-left-radius);

    border-top-right-radius: var(--border-right-radius);
    border-bottom-right-radius: var(--border-right-radius);
}

// Mochi-style flat background (no gradients)
@mixin background($primary: false, $hover: true) {
    @if $primary {
        background: var(--button-primary-bg);
        @if $hover {
            &:hover {
                background: var(--button-primary-gradient-start);
            }
        }
    } @else {
        background: var(--canvas-elevated);
        @if $hover {
            &:hover {
                background: var(--canvas-inset);
                border-color: var(--border);
            }
        }
    }
}

@mixin base(
    $primary: false,
    $border: true,
    $with-hover: true,
    $with-active: true,
    $active-class: "",
    $with-disabled: true
) {
    -webkit-appearance: none;
    cursor: pointer;
    @if $border {
        @if $primary {
            border: none;
        } @else {
            border: 1.5px solid var(--border-subtle);
        }
    } @else {
        border: none;
    }
    @include background($primary, $hover: $with-hover);
    @include soft-elevation(1);

    border-radius: var(--border-radius);
    transition: all var(--transition) var(--easing);

    @if ($primary) {
        color: white;
    } @else {
        color: var(--fg);
    }

    &:hover {
        @include soft-elevation(2);
    }

    @if ($with-active) {
        &:active {
            transform: translateY(1px);
            @include soft-elevation(1);
        }
        @if ($active-class != "") {
            &.#{$active-class} {
                background: var(--button-primary-bg);
                color: white;
                border-color: var(--button-primary-bg);
                @include soft-elevation(1);
            }
        }
    }

    &:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    @if ($with-disabled) {
        &[disabled],
        &[disabled]:hover {
            cursor: not-allowed;
            color: var(--fg-disabled);
            box-shadow: none !important;
            background-color: var(--button-disabled);
            border-color: var(--border-subtle);
            transform: none;
            opacity: 0.6;
        }
    }
}

$focus-color: var(--shadow-focus);

@mixin select($with-disabled: true) {
    width: 100%;

    pointer-events: all;
    cursor: pointer;

    @include base($with-disabled: $with-disabled);

    border-radius: var(--border-radius);

    &.rtl {
        direction: rtl;
    }
}
